<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>ÏûêÏú®Ï£ºÌñâ ÏàúÏ∞∞ Î°úÎ¥á Í¥ÄÏ†ú ÎåÄÏãúÎ≥¥Îìú</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://cdn.jsdelivr.net/npm/roslib@1.0.1/build/roslib.min.js"></script>
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
        />
        <link rel="stylesheet" href="static/css/main.css" />
    </head>
    <body class="min-h-screen p-4 md:p-8">
        <div class="max-w-8xl mx-auto">
            <header
                class="flex justify-between items-center mb-8 pb-4 border-b-2 border-blue-200"
            >
                <h1
                    class="text-4xl font-extrabold text-gray-800 flex items-center"
                >
                    <i class="fas fa-robot text-blue-500 mr-3"></i> ÏàúÏ∞∞ Î°úÎ¥á
                    Í¥ÄÏ†ú ÎåÄÏãúÎ≥¥Îìú
                </h1>
                <div class="flex items-center space-x-4">
                    <div class="text-lg font-bold text-gray-700">
                        <span>{{ username }}</span>Îãò ÌôòÏòÅÌï©ÎãàÎã§.
                    </div>
                    <div
                        id="ros-status"
                        class="flex items-center space-x-2 text-lg font-semibold"
                    >
                        <span
                            id="status-indicator"
                            class="w-4 h-4 rounded-full bg-red-500"
                        ></span>
                        <span id="status-text" class="text-red-700"
                            >ROS Ïó∞Í≤∞ Ï§ë...</span
                        >
                    </div>
                    {% if is_admin %}
                    <a
                        href="/users"
                        class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-lg transition duration-150"
                    >
                        ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨
                    </a>
                    {% endif %}
                    <a
                        href="/logout"
                        class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-150"
                    >
                        Î°úÍ∑∏ÏïÑÏõÉ
                    </a>
                </div>
            </header>

            <div class="grid grid-cols-12 gap-8 relative">
                <div
                    id="main-content-area"
                    class="col-span-12 xl:col-span-8 space-y-4"
                >
                    <div class="main-view-container relative">
                        <div
                            id="map-main"
                            class="main-view dashboard-card p-4 aspect-video relative"
                        >
                            <h2
                                class="text-2xl font-semibold text-gray-700 mb-4 flex items-center"
                            >
                                <i
                                    class="fas fa-map-marked-alt text-blue-500 mr-2"
                                ></i>
                                SLAM ÏàúÏ∞∞ ÏßÄÎèÑ Î∞è Ïã§ÏãúÍ∞Ñ ÏúÑÏπò
                            </h2>
                            <div
                                class="w-full h-full bg-gray-100 flex items-center justify-center rounded-lg overflow-hidden relative"
                            >
                                <canvas
                                    id="map-canvas"
                                    class="w-full h-full object-cover rounded-lg bg-white"
                                ></canvas>
                            </div>
                        </div>

                        <div
                            id="video-main"
                            class="main-view dashboard-card p-4 aspect-video absolute inset-0 hidden"
                        >
                            <h2
                                class="text-2xl font-semibold text-gray-700 mb-4 flex items-center"
                            >
                                <i class="fas fa-video text-green-500 mr-2"></i>
                                Ïã§ÏãúÍ∞Ñ ÏÉÅÌô© Î≥¥Í∏∞ (ÏõπÏ∫†)
                            </h2>
                            <div
                                class="w-full h-full bg-gray-800 flex items-center justify-center rounded-lg relative"
                            >
                                <img
                                    id="webcam-feed"
                                    alt="Ïã§ÏãúÍ∞Ñ ÏõπÏ∫† ÌîºÎìú"
                                    class="w-full h-full object-contain rounded-lg"
                                />
                                <p
                                    id="video-placeholder"
                                    class="text-white text-lg absolute"
                                >
                                    ÏõπÏ∫† Ïä§Ìä∏Î¶¨Î∞ç ÏãúÏûë ÎåÄÍ∏∞ Ï§ë...
                                </p>
                            </div>
                        </div>

                        <div
                            id="map-small"
                            class="small-view bg-white hidden"
                            onclick="toggleMainView('map')"
                        >
                            <canvas
                                id="map-small-canvas"
                                class="w-full h-full object-cover rounded-md bg-gray-100"
                            ></canvas>
                            <span
                                class="absolute top-0 left-0 p-1 text-xs font-bold text-gray-700 bg-white bg-opacity-70 rounded-br-lg"
                                >üó∫Ô∏è ÏßÄÎèÑ</span
                            >
                        </div>

                        <div
                            id="video-small"
                            class="small-view bg-white"
                            onclick="toggleMainView('video')"
                        >
                            <img
                                id="webcam-small-feed"
                                alt="ÏûëÏùÄ ÏõπÏ∫† ÌîºÎìú"
                                class="w-full h-full object-contain rounded-md bg-gray-800"
                            />
                            <span
                                class="absolute top-0 left-0 p-1 text-xs font-bold text-gray-700 bg-white bg-opacity-70 rounded-br-lg"
                                >üìπ ÏõπÏ∫†</span
                            >
                        </div>
                    </div>

                    <div id="patrol-control-map" class="dashboard-card p-4">
                        <h2
                            class="text-xl font-semibold text-gray-700 mb-4 flex items-center"
                        >
                            <i
                                class="fas fa-play-circle text-blue-500 mr-2"
                            ></i>
                            ÏàúÏ∞∞ Î™ÖÎ†π
                        </h2>
                        <div class="grid grid-cols-4 gap-4">
                            <button
                                onclick="publishMission('repeat')"
                                class="btn-action bg-yellow-500 hover:bg-yellow-600 text-white col-span-1"
                            >
                                <i class="fas fa-redo-alt mr-1"></i> Î∞òÎ≥µÏàúÏ∞∞
                            </button>
                            <button
                                onclick="publishMission('single')"
                                class="btn-action bg-green-600 hover:bg-green-700 text-white col-span-1"
                            >
                                <i class="fas fa-location-arrow mr-1"></i> 1Ìöå
                                ÏàúÏ∞∞
                            </button>
                            <button
                                onclick="publishMission('return')"
                                class="btn-action bg-indigo-600 hover:bg-indigo-700 text-white col-span-1"
                            >
                                <i class="fas fa-home mr-1"></i> Î≥µÍ∑Ä
                            </button>
                            <button
                                onclick="publishMission('resume')"
                                class="btn-action bg-gray-600 hover:bg-gray-700 text-white col-span-1"
                            >
                                <i class="fas fa-play mr-1"></i> Ïû¨Í∞ú
                            </button>
                            <button
                                onclick="publishMission('pause')"
                                class="btn-action bg-red-600 hover:bg-red-700 text-white col-span-4"
                            >
                                <i class="fas fa-stop mr-1"></i> ÏùºÏãúÏ†ïÏßÄ
                            </button>
                        </div>
                    </div>

                    <div id="robot-location-card" class="dashboard-card p-4">
                        <h2
                            class="text-xl font-semibold text-gray-700 mb-2 flex items-center"
                        >
                            <i class="fas fa-crosshairs text-blue-500 mr-2"></i>
                            ÌòÑÏû¨ Î°úÎ¥á Ï¢åÌëú
                        </h2>
                        <div
                            id="robot-location"
                            class="text-gray-600 font-bold text-lg"
                        >
                            N/A
                        </div>
                    </div>
                </div>

                <div class="col-span-12 xl:col-span-4 space-y-6">
                    <div class="dashboard-card p-6 text-center">
                        <h2
                            class="text-2xl font-semibold text-gray-700 mb-4 flex items-center justify-center"
                        >
                            <i
                                class="fas fa-info-circle text-blue-500 mr-2"
                            ></i>
                            Î°úÎ¥á ÌòÑÏû¨ ÏÉÅÌÉú
                        </h2>
                        <span
                            id="metric-status"
                            class="status-badge bg-gray-200 text-gray-800"
                        >
                            <i class="fas fa-spinner fa-spin mr-3"></i> Ïó∞Í≤∞
                            ÎåÄÍ∏∞ Ï§ë
                        </span>
                    </div>

                    <div id="manual-control" class="dashboard-card p-6 hidden">
                        <h2
                            class="text-2xl font-semibold text-gray-700 mb-4 flex items-center"
                        >
                            <i class="fas fa-gamepad text-orange-500 mr-2"></i>
                            ÏàòÎèô Ï†úÏñ¥
                        </h2>
                        <div class="grid grid-cols-3 gap-3">
                            <div class="col-span-3 text-center">
                                <button
                                    onclick="publishCommand('forward')"
                                    class="btn-action bg-blue-600 hover:bg-blue-700 text-white w-full"
                                >
                                    <i class="fas fa-arrow-up"></i> Ï†ÑÏßÑ
                                </button>
                            </div>
                            <button
                                onclick="publishCommand('left')"
                                class="btn-action bg-blue-500 hover:bg-blue-600 text-white"
                            >
                                <i class="fas fa-arrow-left"></i> Ï¢åÌöåÏ†Ñ
                            </button>
                            <button
                                onclick="publishCommand('stop')"
                                class="btn-action bg-red-600 hover:bg-red-700 text-white"
                            >
                                Ï†ïÏßÄ
                            </button>
                            <button
                                onclick="publishCommand('right')"
                                class="btn-action bg-blue-500 hover:bg-blue-600 text-white"
                            >
                                <i class="fas fa-arrow-right"></i> Ïö∞ÌöåÏ†Ñ
                            </button>
                            <div class="col-span-3 text-center">
                                <button
                                    onclick="publishCommand('backward')"
                                    class="btn-action bg-blue-600 hover:bg-blue-700 text-white w-full"
                                >
                                    <i class="fas fa-arrow-down"></i> ÌõÑÏßÑ
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-card p-6">
                        <h2
                            class="text-2xl font-semibold text-gray-700 mb-4 flex items-center"
                        >
                            <i class="fas fa-camera text-blue-600 mr-2"></i>
                            ÏõπÏ∫† Ï†úÏñ¥
                        </h2>
                        <button
                            onclick="toggleVideoFeed()"
                            class="btn-action bg-blue-500 hover:bg-blue-600 text-white w-full"
                        >
                            <i class="fas fa-camera mr-2"></i> ÏõπÏ∫† Ïä§Ìä∏Î¶¨Î∞ç
                            ÏãúÏûë
                        </button>
                    </div>

                    <div class="dashboard-card p-4 pb-0">
                        <h2
                            class="text-2xl font-semibold text-gray-700 mb-3 flex items-center"
                        >
                            <i
                                class="fas fa-draw-polygon text-purple-600 mr-2"
                            ></i>
                            ÏàúÏ∞∞ Íµ¨Ïó≠ ÏÑ§Ï†ï
                        </h2>

                        <!-- space-y Ï†úÍ±∞ ‚Üí flexÎ°ú gapÎßå Ïú†ÏßÄ -->
                        <div class="flex flex-col gap-2 mb-0">
                            <button
                                onclick="startDrawingPatrolArea()"
                                id="draw-patrol-btn"
                                class="btn-action bg-purple-500 hover:bg-purple-600 text-white w-full"
                            >
                                <i class="fas fa-mouse-pointer mr-2"></i> ÏßÄÎèÑÏóê
                                Íµ¨Ïó≠ Í∑∏Î¶¨Í∏∞ ÏãúÏûë
                            </button>

                            <button
                                onclick="setPatrolArea()"
                                id="set-patrol-btn"
                                class="btn-action bg-green-500 hover:bg-green-600 text-white w-full hidden"
                            >
                                <i class="fas fa-check-circle mr-2"></i> Íµ¨Ïó≠
                                ÏÑ§Ï†ï ÏôÑÎ£å Î∞è Î™ÖÎ†π Ï†ÑÏÜ°
                            </button>

                            <p
                                id="drawing-status"
                                class="text-sm text-gray-500 hidden mb-0"
                            >
                                ÏßÄÎèÑ ÏúÑÎ•º ÌÅ¥Î¶≠ÌïòÏó¨ ÏàúÏ∞∞ Ïõ®Ïù¥Ìè¨Ïù∏Ìä∏Î•º Ï∞çÏúºÏÑ∏Ïöî.
                                (3Í∞ú Ïù¥ÏÉÅ)
                            </p>
                        </div>
                    </div>

                    <div class="dashboard-card p-6">
                        <h2
                            class="text-2xl font-semibold text-gray-700 mb-6 flex items-center"
                        >
                            <i
                                class="fas fa-tachometer-alt text-teal-500 mr-2"
                            ></i>
                            Î°úÎ¥á Ïã§ÏãúÍ∞Ñ Î©îÌä∏Î¶≠
                        </h2>

                        <div class="grid grid-cols-2 gap-4">
                            <div
                                class="bg-blue-50 p-4 rounded-lg border border-blue-200"
                            >
                                <p class="text-sm text-blue-600 font-medium">
                                    <i class="fas fa-battery-full mr-1"></i>
                                    Î∞∞ÌÑ∞Î¶¨ ÏûîÎüâ
                                </p>
                                <span
                                    id="metric-battery"
                                    class="metric-value text-blue-900"
                                    >--%</span
                                >
                            </div>
                            <div
                                class="bg-indigo-50 p-4 rounded-lg border border-indigo-200"
                            >
                                <p class="text-sm text-indigo-600 font-medium">
                                    <i class="fas fa-route mr-1"></i> ÏàúÏ∞∞ Í±∞Î¶¨
                                </p>
                                <span
                                    id="metric-distance"
                                    class="metric-value text-indigo-900"
                                    >-- m</span
                                >
                            </div>
                            <div
                                class="bg-purple-50 p-4 rounded-lg border border-purple-200 col-span-2"
                            >
                                <p class="text-sm text-purple-600 font-medium">
                                    <i class="fas fa-clock mr-1"></i> ÏàúÏ∞∞ ÏãúÍ∞Ñ
                                </p>
                                <span
                                    id="metric-time"
                                    class="metric-value text-purple-900"
                                    >-- min</span
                                >
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-card p-6">
                        <h2
                            class="text-2xl font-semibold text-gray-700 mb-6 flex items-center"
                        >
                            <i
                                class="fas fa-thermometer-half text-orange-500 mr-2"
                            ></i>
                            ÌôòÍ≤Ω ÏÑºÏÑú Í∞í
                        </h2>

                        <div class="grid grid-cols-3 gap-4">
                            <div
                                class="bg-red-50 p-4 rounded-lg border border-red-200 col-span-1"
                            >
                                <p class="text-sm text-red-600 font-medium">
                                    <i class="fas fa-temperature-high mr-1"></i>
                                    Ïò®ÎèÑ
                                </p>
                                <span
                                    id="metric-temp"
                                    class="env-metric-value text-red-900 mt-2"
                                    >-- ¬∞C</span
                                >
                            </div>

                            <div
                                class="bg-sky-50 p-4 rounded-lg border border-sky-200 col-span-1"
                            >
                                <p class="text-sm text-sky-600 font-medium">
                                    <i class="fas fa-tint mr-1"></i> ÏäµÎèÑ
                                </p>
                                <span
                                    id="metric-humi"
                                    class="env-metric-value text-sky-900 mt-2"
                                    >-- %</span
                                >
                            </div>

                            <div
                                class="bg-yellow-50 p-4 rounded-lg border border-yellow-200 col-span-1"
                            >
                                <p class="text-sm text-yellow-600 font-medium">
                                    <i class="fas fa-smog mr-1"></i> Ïù¥ÏÇ∞ÌôîÌÉÑÏÜå
                                    (CO‚ÇÇ)
                                </p>
                                <span
                                    id="metric-co2"
                                    class="env-metric-value text-yellow-900 mt-2"
                                    >-- ppm</span
                                >
                            </div>

                            <div
                                class="bg-green-50 p-4 rounded-lg border border-green-200 col-span-1"
                            >
                                <p class="text-sm text-green-600 font-medium">
                                    <i class="fas fa-leaf mr-1"></i> TVOC
                                </p>
                                <span
                                    id="metric-tvoc"
                                    class="env-metric-value text-green-900 mt-2"
                                    >-- ppb</span
                                >
                            </div>

                            <div
                                class="bg-blue-50 p-4 rounded-lg border border-blue-200 col-span-1"
                            >
                                <p class="text-sm text-blue-600 font-medium">
                                    <i class="fas fa-fire-alt mr-1"></i> LPG
                                    Í∞ÄÏä§
                                </p>
                                <span
                                    id="metric-lpg"
                                    class="env-metric-value text-blue-900 mt-2"
                                    >-- ppm</span
                                >
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script src="static/js/main.js"></script>
    </body>
</html>
